name: Count Discussions by Category

on:
  workflow_dispatch:  # Allows manual triggering

jobs:
  count_discussions_by_category:
    runs-on: ubuntu-latest

    steps:
      - name: Get discussions count by category
        uses: actions/github-script@v6
        with:
          script: |
            // Fetch all discussions in the repository
            const allDiscussions = await github.rest.discussions.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'all',  // Fetch both open and closed discussions
              per_page: 100  // Adjust this value if you have more discussions
            });

            // Initialize an empty object to store category counts
            const categoryCounts = {};

            // Loop through discussions and count by category
            allDiscussions.data.forEach(discussion => {
              const category = discussion.category.name;
              if (categoryCounts[category]) {
                categoryCounts[category] += 1;
              } else {
                categoryCounts[category] = 1;
              }
            });

            // Log the category counts in JSON format
            console.log(JSON.stringify(categoryCounts, null, 2));

            // Optionally, display the data in table format
            console.table(categoryCounts);
